<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <title>变量命名转换工具</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fa;
      color: #333;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    .left {
      flex: 1;
      padding: 40px;
      background: #fff;
      border-right: 1px solid #eee;
      display: flex;
      flex-direction: column;
      justify-content: center;
      box-shadow: 2px 0 6px rgba(0, 0, 0, 0.05);
      max-width: 45%;
    }

    .left h2 {
      margin-bottom: 20px;
      font-size: 22px;
      color: #222;
    }

    .left input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) inset;
      outline: none;
      transition: all 0.2s;
    }

    .left input:focus {
      border-color: #007bff;
      box-shadow: 0 0 6px rgba(0, 123, 255, 0.3);
    }

    .right {
      flex: 2;
      padding: 40px;
      overflow-y: auto;
      position: relative;
    }

    .group {
      margin-bottom: 20px;
      border-radius: 8px;
      background: #fff;
      padding: 10px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
    }

    .group-title {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
      color: #007bff;
      cursor: pointer;
      user-select: none;
    }

    .group-content {
      transition: max-height 0.3s ease;
      overflow: hidden;
    }

    .result {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      margin-bottom: 6px;
      border-radius: 6px;
      background: #f9f9f9;
      border: 1px solid #e0e0e0;
      font-family: monospace;
      font-size: 14px;
    }

    .result:hover {
      background: #e6f0ff;
    }

    button {
      padding: 4px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #007bff;
      color: #fff;
      font-size: 13px;
      transition: 0.2s;
    }

    button:hover {
      background: #0056b3;
    }

    .translations {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .translation-item {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
      transition: 0.2s;
    }

    .translation-item:hover {
      background: #007bff;
      color: #fff;
      border-color: #007bff;
    }

    .translation-item.active {
      background: #007bff;
      color: #fff;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #007bff;
      color: #fff;
      padding: 10px 16px;
      border-radius: 6px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transform: translateY(-20px);
      transition: 0.3s;
      pointer-events: none;
      z-index: 9999;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .copy-all {
      margin-bottom: 10px;
      padding: 6px 12px;
      background: #28a745;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      border: none;
    }

    .copy-all:hover {
      background: #1e7e34;
    }

    .loading {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 6px 12px;
      background: #ffc107;
      color: #333;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    pre {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 6px;
      overflow: auto;
      max-height: 400px;
    }

    #rawOutput {
      border-radius: 6px;
      max-width: 100%;
      overflow-x: auto;
      /* 横向滚动 */
      word-break: break-all;
      /* 长字符串换行 */
      font-family: monospace;
      font-size: 14px;
      margin-top: 10px;
    }

    #rawOutput pre {
      margin: 0;
      background: transparent;
      padding: 0;
      font-family: monospace;
      font-size: 14px;
      white-space: pre;
      /* 保留空格和换行 */
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="left">
      <h2>变量命名转换工具</h2>
      <input type="text" id="inputText" placeholder="输入变量名，如 myVariable、用户名称">
      <div id="rawOutput"></div>
    </div>
    <div class="right" id="results"></div>
  </div>
  <div id="toast" class="toast"></div>

  <script>
    const input = document.getElementById('inputText');
    const results = document.getElementById('results');
    const rawOutput = document.getElementById('rawOutput');
    const toast = document.getElementById('toast');
    let currentQuery = '';
    let currentController = null;

    // 中文检测
    function hasChinese(str) { return /[\u4e00-\u9fa5]/.test(str); }

    // 翻译 API
    async function translateText(text) {
      if (currentController) {
        currentController.abort(); // 中断上一个请求
      }
      currentController = new AbortController();
      const signal = currentController.signal;

      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'loading';
      loadingDiv.textContent = '正在查询...';
      results.appendChild(loadingDiv);

      try {
        const proxyUrl = `https://quiet-morning-b82c.mkb900716.workers.dev/?q=${encodeURIComponent(text)}`;
        const res = await fetch(proxyUrl, { method: 'GET', headers: { 'Accept': 'application/json' }, signal });
        const data = await res.json();
        return data;
      } catch (e) {
        if (e.name === 'AbortError') return { result: null }; // 请求被中断
        return { result: null };
      } finally {
        if (loadingDiv.parentNode) results.removeChild(loadingDiv);
        currentController = null;
      }
    }

    // 清理输入
    function cleanInput(str) { return str.trim().replace(/[^a-zA-Z0-9\u4e00-\u9fa5\s_-]/g, ''); }

    // 命名转换
    function normalize(str) { str = str.replace(/([a-z])([A-Z])/g, '$1_$2'); str = str.replace(/[-\s]+/g, '_'); return str.toLowerCase().split('_').filter(Boolean); }
    function toCamel(words) { return words.map((w, i) => i === 0 ? w : capitalize(w)).join(''); }
    function toPascal(words) { return words.map(capitalize).join(''); }
    function toSnake(words) { return words.join('_'); }
    function toUpperSnake(words) { return words.join('_').toUpperCase(); }
    function toKebab(words) { return words.join('-'); }
    function capitalize(word) { return word.charAt(0).toUpperCase() + word.slice(1); }

    // Toast
    function showToast(msg) { toast.textContent = msg; toast.classList.add('show'); setTimeout(() => { toast.classList.remove('show'); }, 2000); }
    function copyText(text) { navigator.clipboard.writeText(text).then(() => showToast('已复制: ' + text)); }

    // 渲染格式
    function renderFormats(str) {
      let formatDiv = results.querySelector('.formats-group');
      if (!formatDiv) {
        formatDiv = document.createElement('div');
        formatDiv.className = 'group formats-group';
        results.appendChild(formatDiv);
      }
      formatDiv.innerHTML = '';

      const words = normalize(str);
      const copyAllBtn = document.createElement('button');
      copyAllBtn.className = 'copy-all';
      copyAllBtn.textContent = '一键复制所有结果';
      copyAllBtn.onclick = () => {
        let all = formatDiv.querySelectorAll('.result .text');
        let text = '';
        all.forEach(el => { text += el.textContent.replace(/^[^:]+:\s/, '') + '\n'; });
        copyText(text);
      };
      formatDiv.appendChild(copyAllBtn);

      const groups = {
        '驼峰类': { 'camelCase': toCamel(words), 'PascalCase': toPascal(words) },
        '下划线类': { 'snake_case': toSnake(words), 'UPPER_SNAKE_CASE': toUpperSnake(words) },
        '短横线类': { 'kebab-case': toKebab(words) },
        '其他': { '首字母大写(Title Case)': words.map(capitalize).join(' ') }
      };

      Object.entries(groups).forEach(([groupName, formats]) => {
        const groupDiv = document.createElement('div'); groupDiv.className = 'group';
        const title = document.createElement('div'); title.className = 'group-title'; title.textContent = groupName;
        const content = document.createElement('div'); content.className = 'group-content';
        Object.entries(formats).forEach(([label, value]) => {
          const div = document.createElement('div'); div.className = 'result';
          div.innerHTML = `<div class="text"><strong>${label}:</strong> ${value}</div><button onclick="copyText('${value}')">复制</button>`;
          content.appendChild(div);
        });
        title.onclick = () => { content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + 'px'; };
        groupDiv.appendChild(title);
        groupDiv.appendChild(content);
        formatDiv.appendChild(groupDiv);
      });
    }

    // 渲染翻译候选
    async function renderResults(str) {
      str = cleanInput(str);
      if (!str) return;

      const isNewQuery = str !== currentQuery;
      if (isNewQuery) {
        results.innerHTML = '';
        rawOutput.innerHTML = '';
        currentQuery = str;
      }

      if (hasChinese(str)) {
        const data = await translateText(str);

        if (!data?.result) {
          const pre = document.createElement('div');
          pre.innerHTML = `${data?.output?.text}`;
          results.appendChild(pre);
          return;
        }

        if (Array.isArray(data?.result)) {
          let tDiv = results.querySelector('.translations-group');
          if (!tDiv) {
            tDiv = document.createElement('div');
            tDiv.className = 'group translations-group';
            const title = document.createElement('div');
            title.className = 'group-title';
            title.textContent = '翻译候选（点击选择）';
            const wrap = document.createElement('div');
            wrap.className = 'translations';
            tDiv.appendChild(title);
            tDiv.appendChild(wrap);
            rawOutput.appendChild(tDiv);
          }
          const wrap = tDiv.querySelector('.translations');
          wrap.innerHTML = '';
          data.result.forEach(opt => {
            const item = document.createElement('div');
            item.className = 'translation-item';
            item.textContent = opt;
            item.onclick = () => {
              wrap.querySelectorAll('.translation-item').forEach(el => el.classList.remove('active'));
              item.classList.add('active');
              renderFormats(opt);
            };
            wrap.appendChild(item);
          });
        } else {
          const pre = document.createElement('div');
          pre.innerHTML = `${data?.output?.text}`;
          rawOutput.appendChild(pre);
        }

      } else {
        renderFormats(str);
      }
    }

    // 防抖输入监听
    let debounceTimer;
    input.addEventListener('input', e => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => renderResults(e.target.value), 800);
    });
  </script>
</body>

</html>